// components/CharityModal.tsx
// ------------------------------------------------------
// Modal: V√§lg√∂renhet (Swish + snabb projektlista + kopiering)
// - Radix Dialog (finns i dina deps)
// - H√§mtar SWISH_NUMBER + projekt fr√•n safe/charity/data
// - Copy-knappar med navigator.clipboard
// - L√§nk till /charity om du vill ha full sida (kan fungera parallellt)
// ------------------------------------------------------
"use client"

import * as Dialog from "@radix-ui/react-dialog"
import { useState } from "react"
import { charityProjects, SWISH_NUMBER } from "@/safe/charity/data"
import Link from "next/link"

// Hj√§lpfunktion: format + sms-l√§nk
function toE164FromSwedish(s: string) {
  // "072-850 25 84" -> "+46728502584"
    const digits = s.replace(/\D/g, "") // bara siffror
      const withoutLeadingZero = digits.replace(/^0/, "")
        return `+46${withoutLeadingZero}`
        }

        export default function CharityModal({
          open,
            onOpenChange,
            }: {
              open: boolean
                onOpenChange: (v: boolean) => void
                }) {
                  const [copied, setCopied] = useState<"swish" | null>(null)

                    async function copySwish() {
                        try {
                              await navigator.clipboard.writeText(SWISH_NUMBER)
                                    setCopied("swish")
                                          setTimeout(() => setCopied(null), 1200)
                                              } catch {
                                                    setCopied("swish")
                                                          setTimeout(() => setCopied(null), 1200)
                                                              }
                                                                }

                                                                  const smsHref = `sms:${toE164FromSwedish(SWISH_NUMBER)}?body=Afrika%20%23{projektnr}`

                                                                    // Vi visar 6 billigare exempel i modalen (full lista finns p√• /charity)
                                                                      const examples = charityProjects
                                                                          .slice() // kopia
                                                                              .sort((a, b) => a.cost - b.cost)
                                                                                  .slice(0, 6)

                                                                                    return (
                                                                                        <Dialog.Root open={open} onOpenChange={onOpenChange}>
                                                                                              {/* Overlay */}
                                                                                                    <Dialog.Portal>
                                                                                                            <Dialog.Overlay
                                                                                                                      className="
                                                                                                                                  fixed inset-0 bg-black/30
                                                                                                                                              data-[state=open]:animate-fadeIn
                                                                                                                                                        "
                                                                                                                                                                />
                                                                                                                                                                        {/* Inneh√•ll */}
                                                                                                                                                                                <Dialog.Content
                                                                                                                                                                                          className="
                                                                                                                                                                                                      fixed left-1/2 top-1/2 w-[95vw] max-w-xl -translate-x-1/2 -translate-y-1/2
                                                                                                                                                                                                                  rounded-2xl bg-white p-5 shadow-2xl
                                                                                                                                                                                                                              border
                                                                                                                                                                                                                                          data-[state=open]:animate-popIn
                                                                                                                                                                                                                                                    "
                                                                                                                                                                                                                                                            >
                                                                                                                                                                                                                                                                      {/* Titel + st√§ng */}
                                                                                                                                                                                                                                                                                <div className="flex items-center justify-between mb-2">
                                                                                                                                                                                                                                                                                            <Dialog.Title className="text-xl font-bold">
                                                                                                                                                                                                                                                                                                          V√§lg√∂renhet üôèüèº
                                                                                                                                                                                                                                                                                                                      </Dialog.Title>
                                                                                                                                                                                                                                                                                                                                  <Dialog.Close
                                                                                                                                                                                                                                                                                                                                                className="rounded-lg px-2 py-1 text-slate-600 hover:bg-slate-100"
                                                                                                                                                                                                                                                                                                                                                              aria-label="St√§ng"
                                                                                                                                                                                                                                                                                                                                                                          >
                                                                                                                                                                                                                                                                                                                                                                                        St√§ng
                                                                                                                                                                                                                                                                                                                                                                                                    </Dialog.Close>
                                                                                                                                                                                                                                                                                                                                                                                                              </div>

                                                                                                                                                                                                                                                                                                                                                                                                                        {/* Swish-kort */}
                                                                                                                                                                                                                                                                                                                                                                                                                                  <div className="rounded-xl border p-4 shadow-sm mb-4 bg-gradient-to-r from-blue-50 to-purple-50">
                                                                                                                                                                                                                                                                                                                                                                                                                                              <div className="text-sm text-slate-600 mb-1">üì± Swish</div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                          <div className="flex items-center justify-between gap-3">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <div className="text-lg font-mono">{SWISH_NUMBER}</div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <button
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      onClick={copySwish}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      className="px-3 py-1.5 rounded-lg bg-blue-600 text-white text-sm font-semibold hover:bg-blue-700"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    >
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    {copied === "swish" ? "Kopierat!" : "Kopiera"}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  </button>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <div className="mt-2 text-sm text-slate-700">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        M√§rk meddelandet: <span className="font-mono">Afrika #{`{projektnr}`}</span>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <a
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              href={smsHref}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            className="inline-block mt-2 text-blue-700 underline text-sm"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        >
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      √ñppna SMS med f√∂rifylld m√§rkning
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  </a>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </div>

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      {/* Exempelprojekt (billiga) */}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <div className="mb-3">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <div className="font-semibold mb-2">Billiga exempel</div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <ul className="grid gap-2">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      {examples.map((p) => (
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <li
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        key={p.id}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          className="flex items-center justify-between rounded-lg border p-3 bg-white"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          >
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <div className="font-medium">#{p.id} {p.title}</div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <div className="text-xs text-slate-500">{p.description}</div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <div className="text-right">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <div className="font-mono">{p.cost} kr</div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <Link
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      href={`/charity/${p.id}`}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            className="text-blue-600 underline text-xs"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  onClick={() => onOpenChange(false)}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      >
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            Mer info
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </Link>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  </li>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ))}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </ul>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      </div>

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                {/* L√§nkar l√§ngst ner */}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <div className="flex items-center justify-between pt-3 border-t">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <Link
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    href="/charity"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  className="text-blue-700 underline text-sm"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                onClick={() => onOpenChange(false)}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            >
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          G√• till alla projekt
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      </Link>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <Dialog.Close
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                className="px-4 py-2 rounded-xl bg-blue-100 text-blue-800 font-semibold hover:bg-blue-200"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            >
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          Klar
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      </Dialog.Close>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </Dialog.Content>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              </Dialog.Portal>

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    {/* Sm√• keyframe-utilities (Tailwind 4 st√∂der @utility i CSS, men k√∂r inline h√§r enkelt) */}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <style jsx global>{`
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  @keyframes fadeIn { from { opacity: 0 } to { opacity: 1 } }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          @keyframes popIn { 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    0% { opacity: 0; transform: translate(-50%, -55%) scale(.98); }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              100% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              .animate-fadeIn { animation: fadeIn .15s ease-out both }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      .animate-popIn { animation: popIn .2s ease-out both }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            `}</style>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </Dialog.Root>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  )
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  }
